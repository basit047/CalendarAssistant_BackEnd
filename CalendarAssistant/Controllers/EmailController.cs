using CalendarAssistant.ActionFilters;
using CalendarAssistant.Models;
using CalendarAssistant.Services;
using Microsoft.AspNetCore.Mvc;
using Newtonsoft.Json;

namespace CalendarAssistant.Controllers
{
    [ApiController]
    [Route("[controller]")]
    public class EmailController : ControllerBase
    {
        private readonly IGoogleGmailService _gmailService;
        public EmailController(IGoogleGmailService gmailService)
        {
            _gmailService = gmailService;
        }

        [TokenValidationFilter]
        [HttpGet("GetLabels")]
        public async Task<ActionResult> GetLabels()
        {
            try
            {
                var accessToken = Request.Headers["Access_token"].FirstOrDefault();
                var labels = await _gmailService.GetGmailLabels(accessToken);

                return Ok(labels);
            }
            catch (Exception ex)
            {
                return BadRequest($"Error fetching labels: {ex.Message}");
            }
        }

        [TokenValidationFilter]
        [HttpGet("GetMail")]
        public async Task<ActionResult> GetMail([FromQuery] MailFilter filters)
        {
            try
            {
                var accessToken = Request.Headers["Access_token"].FirstOrDefault();
                var subjects = await _gmailService.GetMails(filters, accessToken);

                return Ok(subjects);
            }
            catch (Exception ex)
            {
                return BadRequest($"Error fetching mail: {ex.Message}");
            }
        }

        [TokenValidationFilter]
        [HttpPost("SendMail")]
        public async Task<ActionResult> SendMail([FromBody] SendEmailModel sendEmailModel)
        {
            try
            {
                var accessToken = Request.Headers["Access_token"].FirstOrDefault();
                var data = await _gmailService.SendEmail(sendEmailModel, accessToken);
                return Ok(data);
            }
            catch (Exception ex)
            {
                return BadRequest($"Error sending email: {ex.Message}");
            }
        }

        [TokenValidationFilter]
        [HttpGet("GetMailPolling")]
        public async Task<ActionResult> GetMailPolling([FromQuery] EmailSyncModel emailSyncModel)
        {
            try
            {
                Console.WriteLine("Inside GetMailPolling Method");
                Console.WriteLine($"EmailSyncModel: {emailSyncModel.LabelsToExclude}");
                var accessToken = Request.Headers["Access_token"].FirstOrDefault();
                var idToken = Request.Headers["Authorization"].FirstOrDefault();
                // string json = @"[{""From"":""LinkedIn Job Alerts <jobalerts-noreply@linkedin.com>"",""Snippet"":""View jobs in Frankfurt Rhine-Main Metropolitan Area ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏"",""IsMeetingInvite"":false,""HasConflict"":false,""ReceivedAt"":""2025-07-12T09:10:45Z"",""EventModel"":null,""CalendarEvent"":null,""NonMeetingInviteResponse"":{""Summary"":""the email sender expressed their interest in viewing jobs within the frankfurt rhine-main metropolitan area, prompting us to provide information on the available positions and relevant job search resources for them.\n\n-----------\ndear [recipient's name],\n\nthank you for your inquiry about job opportunities in the frankfurt rhine-main metropolitan area. our database currently has a variety of roles across various industries, including finance, technology, healthcare, and more. you can explore these positions through our online portal or directly contact employers to request information on available vacancies.\n\nto begin your job search journey, you may also consider utilizing additional resources such as the official frankfurt rhine-main metropolitan area jobs webpage, local networking events, and professional social media platforms like linkedin for further assistance in finding suitable positions.\n\nif there is anything specific that you need help with or any particular industries or job roles you are interested in, please let us know so we can provide more targeted information to assist your search.\n\nwe hope this helps and wish you luck in your career pursuits!\n\nkind regards,\n[your name]\n[your position]\n[company/organization]"",""ResponseSuggestedByLLM"":""dear [recipient's name],\n\nthank you for reaching out. we appreciate your interest in exploring job opportunities within the frankfurt rhine-main metropolitan area. below is a summary of the available jobs and resources that can assist you further:""},""Title"":null,""MessageId"":""<359464517.11659964.1752311445781@lva1-app52037.prod.linkedin.com>"",""Attendees"":null},{""From"":""Harris and Basit <harris.basit@gmail.com>"",""Snippet"":""Sync Abdul You have been invited by Harris and Basit to attend an event named Sync Abdul on Monday Jul 14, 2025 ⋅ 11am – 12pm (Central European Time - Berlin). When Monday Jul 14, 2025 ⋅ 11am – 12pm ("",""IsMeetingInvite"":true,""HasConflict"":true,""ReceivedAt"":""2025-07-12T09:08:24Z"",""EventModel"":{""StartDateTime"":""2025-07-14T11:00:00"",""EndDateTime"":""2025-07-14T12:00:00"",""Title"":""Sync Abdul You have been invited by Harris and Basit to attend an event named Sync Abdul on Monday Jul 14, 2025 ⋅ 11am – 12pm (Central European Time - Berlin). When Monday Jul 14, 2025 ⋅ 11am – 12pm ("",""ConflictingTitle"":""Working Day WSA"",""ConflictingStartDateTime"":""2025-07-14T08:30:00+02:00"",""ConflictingEndDateTime"":""2025-07-14T16:30:00+02:00"",""SuggestedStartDateTime"":""2025-07-15T13:00:00+02:00"",""SuggestedEndDateTime"":""2025-07-15T14:00:00+02:00"",""UpdateEvent"":{""EventId"":""41edsmi69h73f5a6feb0hgqqi9"",""EventObj"":{""anyoneCanAddSelf"":null,""attachments"":null,""attendees"":[{""additionalGuests"":null,""comment"":null,""displayName"":null,""email"":""harris.basit@gmail.com"",""id"":null,""optional"":null,""organizer"":true,""resource"":null,""responseStatus"":""accepted"",""self"":null,""ETag"":null},{""additionalGuests"":null,""comment"":null,""displayName"":null,""email"":""basit.a.raja@gmail.com"",""id"":null,""optional"":null,""organizer"":null,""resource"":null,""responseStatus"":""needsAction"",""self"":true,""ETag"":null}],""attendeesOmitted"":null,""birthdayProperties"":null,""colorId"":null,""conferenceData"":null,""created"":""2025-07-12T09:08:19.000Z"",""creator"":{""displayName"":null,""email"":""harris.basit@gmail.com"",""id"":null,""self"":null},""description"":null,""end"":{""date"":null,""dateTime"":""2025-07-15T14:00:00.000+02:00"",""timeZone"":""Europe/Berlin"",""ETag"":null},""endTimeUnspecified"":null,""etag"":""\""3504622607511454\"""",""eventType"":""default"",""extendedProperties"":null,""focusTimeProperties"":null,""gadget"":null,""guestsCanInviteOthers"":null,""guestsCanModify"":null,""guestsCanSeeOtherGuests"":null,""hangoutLink"":null,""htmlLink"":""https://www.google.com/calendar/event?eid=NDFlZHNtaTY5aDczZjVhNmZlYjBoZ3FxaTkgYmFzaXQuYS5yYWphQG0"",""iCalUID"":""41edsmi69h73f5a6feb0hgqqi9@google.com"",""id"":""41edsmi69h73f5a6feb0hgqqi9"",""kind"":""calendar#event"",""location"":null,""locked"":null,""organizer"":{""displayName"":null,""email"":""harris.basit@gmail.com"",""id"":null,""self"":null},""originalStartTime"":null,""outOfOfficeProperties"":null,""privateCopy"":null,""recurrence"":null,""recurringEventId"":null,""reminders"":{""overrides"":null,""useDefault"":true},""sequence"":0,""source"":null,""start"":{""date"":null,""dateTime"":""2025-07-15T13:00:00.000+02:00"",""timeZone"":""Europe/Berlin"",""ETag"":null},""status"":""confirmed"",""summary"":""Sync Abdul"",""transparency"":null,""updated"":""2025-07-12T09:08:23.755Z"",""visibility"":null,""workingLocationProperties"":null},""Attendees"":[""harris.basit@gmail.com"",""basit.a.raja@gmail.com""]},""SendEmailModel"":{""To"":""harris.basit@gmail.com"",""Subject"":""Reschedule: Sync Abdul"",""Message"":""Dear Organizer,\nI wanted to propose rescheduling the meeting currently set for: Sync Abdul on July 15 at 1:00 pm - July 15 at 2:00 pm.\nThanks!"",""MessageId"":null}},""CalendarEvent"":null,""NonMeetingInviteResponse"":null,""Title"":null,""MessageId"":""<calendar-7efb63dc-e0bf-4657-a475-af06c6862678@google.com>"",""Attendees"":null},{""From"":""Harris and Basit <harris.basit@gmail.com>"",""Snippet"":""Hey Abdul, Can we meet up tomorrow for a short meeting? Regards, Abdul"",""IsMeetingInvite"":true,""HasConflict"":false,""ReceivedAt"":""2025-07-12T09:07:44Z"",""EventModel"":null,""CalendarEvent"":{""Summary"":""Meeting Call set up by LLM Scheduler"",""Location"":""Berlin"",""Description"":""Meeting Call set up by LLM Scheduler"",""StartTime"":""2025-07-13T00:00:00"",""EndTime"":""2025-07-13T00:30:00"",""Attendees"":[""Harris and Basit <harris.basit@gmail.com>""]},""NonMeetingInviteResponse"":null,""Title"":null,""MessageId"":""<CAJByuP1CozWiZ+GGhA9TpnFoQQV4B88cmd3GZb175f49o-U-Og@mail.gmail.com>"",""Attendees"":null}]";
                // string daaat = @"[{""From"":""Netflix <info@members.netflix.com>"",""Snippet"":""Get a first look today. ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏"",""IsMeetingInvite"":false,""HasConflict"":false,""ReceivedAt"":""2025-07-13T12:33:25Z"",""EventModel"":null,""CalendarEvent"":null,""NonMeetingInviteResponse"":{""Summary"":""the sender expresses gratitude for the invitation and requests information regarding the first-look opportunity. they are open to receiving further details promptly.\n\n-------\nthank you for granting us a first look today. we appreciate your consideration and eagerly await further instructions. please share any additional requirements or next steps, as well as specifics about this offer, at your earliest convenience. looking forward to our collaboration.\n\nbest regards,\n[your name]"",""ResponseSuggestedByLLM"":""subject: re: first look opportunity\n\ndear [recipient's name],\n\nthank you for reaching out and providing this exciting opportunity. i am eager to get a first look at the details you mentioned, so please share them with me at your earliest convenience.\n\nbest regards,\n[your name]""},""Title"":null,""MessageId"":""<0100019803c6a1ed-7117bb14-efe3-4cff-96e0-22ca4f018bc3-000000@email.amazonses.com>"",""Attendees"":null},{""From"":""Glassdoor-Jobs <noreply@glassdoor.com>"",""Snippet"":""Bluetec Engineering stellt jetzt ein ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍"",""IsMeetingInvite"":false,""HasConflict"":false,""ReceivedAt"":""2025-07-13T12:04:57Z"",""EventModel"":null,""CalendarEvent"":null,""NonMeetingInviteResponse"":{""Summary"":""thanked the sender for sharing information on bluetec's latest program and expressed interest in learning more details about its features and potential collaboration opportunities."",""ResponseSuggestedByLLM"":""subject: acknowledgment of the new program at bluetec engineering\n\ndear [recipient's name],\n\nthank you for sharing information about bluetec engineering's latest initiative. i am pleased to learn more about this exciting development and its potential impact on your company and industry as a whole.\n\nif possible, could you please provide further details regarding the specific features and benefits of the program? this would help me better understand how it aligns with our organization's goals and interests. additionally, i am interested in any collaboration opportunities that may arise from this new venture.\n\ni look forward to hearing more about your innovative approach at bluetec engineering. \n\nthank you once again for keeping us informed.\n\nbest regards,\n[your name]""},""Title"":null,""MessageId"":""<ETXrl5WpQSis_CFi1a_O-Q@geopod-ismtpd-1>"",""Attendees"":null},{""From"":""Glassdoor-Jobs <noreply@glassdoor.com>"",""Snippet"":""Qvest stellt jetzt ein ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍‎‏﻿ ‌​‍"",""IsMeetingInvite"":false,""HasConflict"":false,""ReceivedAt"":""2025-07-13T12:04:28Z"",""EventModel"":null,""CalendarEvent"":null,""NonMeetingInviteResponse"":{""Summary"":""the recipient acknowledges the receipt of an unclear message, asks for clarification, and offers assistance related to qvest."",""ResponseSuggestedByLLM"":""dear sender,\n\nthank you for reaching out. it seems there might have been a typo or omission in the email content. could you please provide more details regarding the subject? i'm here to assist you with any further information needed on qvest matters.\n\n-------""},""Title"":null,""MessageId"":""<Y8NFp5GNTXSZJEfvS1v9-Q@geopod-ismtpd-canary-0>"",""Attendees"":null},{""From"":""Indeed <alert@indeed.com>"",""Snippet"":""Bewerben Sie sich bei: Kramer &amp; Crew GmbH &amp; Co. KG, Bertrandt AG und Liebherr-Digital Development Center GmbH ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌"",""IsMeetingInvite"":false,""HasConflict"":false,""ReceivedAt"":""2025-07-13T11:29:56Z"",""EventModel"":null,""CalendarEvent"":null,""NonMeetingInviteResponse"":{""Summary"":""the sender expressed gratitude for the information regarding job opportunities at kramer & crew gmbh & co. kg, bertrandt ag, and liebherr-digital development center gmbh. they provided their resume as a follow-up to indicate interest in applying for these positions."",""ResponseSuggestedByLLM"":""dear sender,\n\nthank you for informing me about the opportunities to apply at kramer & crew gmbh & co. kg, bertrandt ag, and liebherr-digital development center gmbh. i appreciate being considered for these positions. please find my attached resume below, which highlights my relevant skills and experiences that align with your company's requirements.\n\nsincerely, [your name]""},""Title"":null,""MessageId"":""<1j01oovsoh5sv801.1752406196820.Railgunner@railgun--railgunner-jobsearchrailclipservice-54fd468f6-5hvp7>"",""Attendees"":null},{""From"":""Harris and Basit <harris.basit@gmail.com>"",""Snippet"":""Wie geht es dir? Alles gut?"",""IsMeetingInvite"":false,""HasConflict"":false,""ReceivedAt"":""2025-07-13T11:21:58Z"",""EventModel"":null,""CalendarEvent"":null,""NonMeetingInviteResponse"":{""Summary"":""acknowledging the sender's inquiry about one's well-being, i responded positively to their message expressing that things are good and appreciated their concern.\n\n-------"",""ResponseSuggestedByLLM"":""dear [recipient's name],\n\ni hope this email finds you well. thank you for checking in on me; everything is going great!""},""Title"":null,""MessageId"":""<CAJByuP0qoFTwhUCLniR6Q-D=0c9KZ8pXSPP=+=iXKRDYTT-9jg@mail.gmail.com>"",""Attendees"":null},{""From"":""LinkedIn Job Alerts <jobalerts-noreply@linkedin.com>"",""Snippet"":""Instaffo Softwareentwickler .NET: Softwareentwickler .NET bei znt Zentren für Neue… ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏"",""IsMeetingInvite"":false,""HasConflict"":false,""ReceivedAt"":""2025-07-13T11:10:25Z"",""EventModel"":null,""CalendarEvent"":null,""NonMeetingInviteResponse"":{""Summary"":""the reply thanked instaffo for their interest in collaboration and requested further details about the partnership's potential areas of synergy and mutual support."",""ResponseSuggestedByLLM"":""dear instaffo team,\n\nthank you for reaching out to us at instaffo softwareentwickler.net. we appreciate your interest in partnering with us and would be delighted to learn more about the potential collaboration opportunities between our teams.\n\nplease provide additional information on how we can best support each other and what specific areas of synergy you envision, so that we may better understand your needs and objectives.\n\nlooking forward to hearing from you soon!\n\nbest regards,\n[your name]\ninstaffo softwareentwickler .net""},""Title"":null,""MessageId"":""<1693400610.5383765.1752405025744@lor1-app85422.prod.linkedin.com>"",""Attendees"":null},{""From"":""LinkedIn Job Alerts <jobalerts-noreply@linkedin.com>"",""Snippet"":""View jobs in Germany ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏"",""IsMeetingInvite"":false,""HasConflict"":false,""ReceivedAt"":""2025-07-13T09:10:25Z"",""EventModel"":null,""CalendarEvent"":null,""NonMeetingInviteResponse"":{""Summary"":""the recipient has been informed about various job openings in germany and expressed interest in learning more details regarding specific fields, roles, and application timelines. a follow-up query was made for additional information to facilitate the research process.\n\n-------\ndear [recipient's name],\n\nthank you for sharing the link to job listings in germany. i appreciate your initiative and will definitely explore these opportunities further. in order to get a better understanding of the available positions, may i kindly request more specific information on industries, roles, and any application deadlines? \n\nbest regards, [your name]"",""ResponseSuggestedByLLM"":""subject: re: viewing jobs in germany\n\ndear [recipient's name],\n\nthank you for sharing the link to job listings in germany. i appreciate your initiative and will definitely explore these opportunities further. in order to get a better understanding of the available positions, may i kindly request more specific information on industries, roles, and any application deadlines?""},""Title"":null,""MessageId"":""<1258365906.13375851.1752397825129@lva1-app80026.prod.linkedin.com>"",""Attendees"":null},{""From"":""Sophia Weinig von Workwise <sophia.weinig@workwise.io>"",""Snippet"":""Schnoor Industrieelektronik GmbH und 3 andere Unternehmen haben neue Jobs veröffentlicht 3 Jobs passen zu deinem Profil: Softwareentwickler C++ (w/m/d) Company Logo Schnoor Industrieelektronik GmbH"",""IsMeetingInvite"":false,""HasConflict"":false,""ReceivedAt"":""2025-07-13T08:23:31Z"",""EventModel"":null,""CalendarEvent"":null,""NonMeetingInviteResponse"":{""Summary"":""the recipient of the email expressed gratitude and conveyed interest in applying for the software developer position specializing in c++ at schnoor industrieelektronik gmbh that matches their qualifications. they look forward to further discussions about their skills aligning with the role requirements."",""ResponseSuggestedByLLM"":""reply:\ndear schnoor industrieelektronik gmbh,\n\nthank you for sharing the new job opportunities with us. after reviewing the positions of software developer specializing in c++ (matched to my qualifications), i would like to express my interest and submit my application accordingly. \n\ni am looking forward to further discussions on how my skills align with the role requirements. thank you once again for considering me as a potential candidate for these positions.\n\nbest regards,\n[your name]""},""Title"":null,""MessageId"":null,""Attendees"":null},{""From"":""Indeed <invitationtoapply@match.indeed.com>"",""Snippet"":""60.000 € – 65.000 € pro Jahr. Guten Tag Abdul Basit, aufgrund Ihres Hintergrunds könnte diese Stelle als Microsoft Dynamics NAV/BC Inhouse Software Developer (m/w/d), Raum Bamberg/Würzburg für Sie"",""IsMeetingInvite"":false,""HasConflict"":false,""ReceivedAt"":""2025-07-13T08:13:24Z"",""EventModel"":null,""CalendarEvent"":null,""NonMeetingInviteResponse"":{""Summary"":""the candidate expressed gratitude for being considered for the software developer position at bamberg and würzburg and acknowledged the provided salary range within germany's expectations. they showed interest in discussing further details about the role and requested information on next steps to advance their selection process."",""ResponseSuggestedByLLM"":""dear abdul basit,\n\nthank you for considering me for the position as a microsoft dynamics nav/bc inhouse software developer in your teams at bamberg and würzburg. based on my skills and experience, i believe this opportunity aligns well with my professional goals.\n\ni appreciate the provided salary range of €60,000 to €65,000 per year. this is within the expected compensation for a senior software developer position in germany, considering factors such as location, industry standards and qualifications. i am looking forward to discussing further details about the role and potential benefits.\n\nplease let me know what steps need to be taken next so that we can progress with your selection process. \n\nthank you once again for this opportunity.\n\nbest regards,\n[your name]""},""Title"":null,""MessageId"":""<1j01dgpr2pvmf80b.1752394404668.Railgunner@railgun--railgunner-elephanti2arailclipservice-5d88795d69-fpll6>"",""Attendees"":null},{""From"":""XING Jobs <jobs@mail.xing.com>"",""Snippet"":""New job ads based on your search alert view in browser XING startpage Abdul Basit Hi Abdul Basit, 1 new job ad matching your search criteria. zur Jobanzeige Instaffo GmbH Earn up to 20% more Junior"",""IsMeetingInvite"":false,""HasConflict"":false,""ReceivedAt"":""2025-07-13T07:43:05Z"",""EventModel"":null,""CalendarEvent"":null,""NonMeetingInviteResponse"":{""Summary"":""abdul basit informed me about a new job ad matching my search criteria from instaffo gmbh, prompting interest to gather further information on the position and application procedure.\n---------\ndear abdul basit,\n\nthank you for bringing this exciting opportunity with instaffo gmbh to my attention. i am indeed intrigued by the prospect of a junior role that offers an increased earning potential up to 20%. to proceed further, could you kindly share more details about job responsibilities and requirements? additionally, please inform me of any application steps or deadlines associated with this position.\n\nlooking forward to your response.\n\nbest regards,\n---------\ndear abdul basit,\n\ni appreciate the alert regarding the new job posting from instaffo gmbh that aligns with my search criteria. i am eager to explore this opportunity further and understand more about the role's specific responsibilities, qualifications, and any other essential details you could share.\n\nthank you for your assistance in keeping me informed of relevant job opportunities.\n\nwarm regards,\n---------"",""ResponseSuggestedByLLM"":""dear abdul basit,\n\nthank you for the notification about the new job opportunity with instaffo gmbh that matches your search criteria. i'm interested in learning more about this position and would appreciate any additional details you can provide regarding the role and application process.\n\nplease find below a summary of our conversation:""},""Title"":null,""MessageId"":""<68736389c3d28_5b091540364398@hermes-worker-8f5668c84-2hrfs.mail>"",""Attendees"":null},{""From"":""XING Jobs <jobs@mail.xing.com>"",""Snippet"":""New job ads based on your search alert view in browser XING startpage Abdul Basit Hi Abdul Basit, 14 new jobs matching your search criteria. zur Jobanzeige INNEO Solutions GmbH Earn up to 38% more"",""IsMeetingInvite"":false,""HasConflict"":false,""ReceivedAt"":""2025-07-13T07:30:36Z"",""EventModel"":null,""CalendarEvent"":null,""NonMeetingInviteResponse"":{""Summary"":""the recipient received a notification regarding new job ads that match their search criteria and expressed interest in learning more about one specific opportunity while appreciating updates for future notifications."",""ResponseSuggestedByLLM"":""dear abdul basit,\n\nthank you for sharing the job alerts with me. i appreciate being informed about new opportunities that match my search criteria. the job at inneo solutions gmbh sounds interesting, especially with an earning potential of up to 38%. could you please provide more details about this position? also, feel free to keep updating me on similar job alerts in the future.\n\nbest regards,\n[your name]\n\nsuggested""},""Title"":null,""MessageId"":""<6873609c9b2d6_17f1540753244@hermes-worker-8f5668c84-9n4l4.mail>"",""Attendees"":null},{""From"":""LinkedIn Job Alerts <jobalerts-noreply@linkedin.com>"",""Snippet"":""Rahantech GmbH C#/.NET Developer (m/f/d): Tasks Develop, design, and maintain high-quality… ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏"",""IsMeetingInvite"":false,""HasConflict"":false,""ReceivedAt"":""2025-07-13T07:10:28Z"",""EventModel"":null,""CalendarEvent"":null,""NonMeetingInviteResponse"":{""Summary"":""the recipient expressed interest in learning more about their responsibilities as a c#/.net developer at rahantech gmbh and appreciated the details provided regarding tasks related to development, design, and maintenance of high-quality software solutions. in response, they showed enthusiasm for contributing to these goals and requested further information or preparation if necessary."",""ResponseSuggestedByLLM"":""subject: re: tasks as a c#/.net developer at rahantech gmbh\n\ndear [recipient's name],\n\nthank you for reaching out and providing me with more information about the tasks i will be undertaking in my role as a c#/.net developer at rahantech gmbh.\n\ni am excited to contribute to developing, designing, and maintaining high-quality software solutions that meet the needs of our clients and company objectives. please let me know if there is any specific preparation or information i need before starting my role.\n\nbest regards,\n[your name]""},""Title"":null,""MessageId"":""<899040424.8228023.1752390628265@ltx1-app65544.prod.linkedin.com>"",""Attendees"":null},{""From"":""XING Jobs <jobs@mail.xing.com>"",""Snippet"":""New job ads based on your search alert view in browser XING startpage Abdul Basit Hi Abdul Basit, 4 new jobs matching your search criteria. zur Jobanzeige SAP Earn up to 84% more (Senior) DevOps"",""IsMeetingInvite"":false,""HasConflict"":false,""ReceivedAt"":""2025-07-13T06:48:09Z"",""EventModel"":null,""CalendarEvent"":null,""NonMeetingInviteResponse"":{""Summary"":""abdul basit received job alerts from xing with four new positions matching his search criteria, including a senior devops role at sap that offers potential earnings of up to 84%. he expressed gratitude for the information and intends to review these opportunities carefully before contacting the respective companies.\n\n-------"",""ResponseSuggestedByLLM"":""dear abdul basit,\n\nthank you for sharing the job alerts with me. i appreciate your prompt response and would like to take a closer look at these opportunities, especially the sap earn up to 84% more (senior) devops position. i will review them carefully and reach out if any seem suitable for my career advancement.""},""Title"":null,""MessageId"":""<687356a985794_2fe1b154043729b@hermes-worker-8f5668c84-xn7kl.mail>"",""Attendees"":null},{""From"":""Indeed <alert@indeed.com>"",""Snippet"":""Bewerben Sie sich bei: Kramer &amp; Crew GmbH &amp; Co. KG, Apaleo und Bertrandt AG ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌"",""IsMeetingInvite"":false,""HasConflict"":false,""ReceivedAt"":""2025-07-13T04:05:54Z"",""EventModel"":null,""CalendarEvent"":null,""NonMeetingInviteResponse"":{""Summary"":""the sender expressed their interest in applying at kramer & crew gmbh & co. kg and apaleo und bertrandt ag and requested guidance on submitting the application along with an overview of job responsibilities."",""ResponseSuggestedByLLM"":""subject: bewerbung bei kramer & crew gmbh & co. kg, apaleo und bertrandt ag\n\ndear [recipient's name],\n\nthank you for sharing the opportunity to apply at kramer & crew gmbh & co. kg and apaleo und bertrandt ag. i am interested in submitting my application as requested, so please let me know how best to proceed with it. \n\nif there are any specific documents or information you require from me, kindly inform me at your earliest convenience. also, if possible, providing an overview of the job role and responsibilities would help me tailor my application accordingly.\n\nlooking forward to hearing back from you soon. thank you for considering my application.\n\nbest regards, \n[your name]\n\nsuggested""},""Title"":null,""MessageId"":""<1j00vbsnag7ql800.1752379554190.Railgunner@railgun--railgunner-jobsearchrailclipservice-54fd468f6-sqln5>"",""Attendees"":null},{""From"":""Indeed <alert@indeed.com>"",""Snippet"":""Bewerben Sie sich bei: Philips, Bosch Group und NOKIA ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌ ‌"",""IsMeetingInvite"":false,""HasConflict"":false,""ReceivedAt"":""2025-07-13T00:10:18Z"",""EventModel"":null,""CalendarEvent"":null,""NonMeetingInviteResponse"":{""Summary"":"""",""ResponseSuggestedByLLM"":null},""Title"":null,""MessageId"":""<1j00hsfhhg4ba800.1752365418383.Railgunner@railgun--railgunner-jobsearchrailclipservice-54fd468f6-sqln5>"",""Attendees"":null}, {""From"":""LinkedIn Job Alerts <jobalerts-noreply@linkedin.com>"",""Snippet"":""View jobs in Frankfurt Rhine-Main Metropolitan Area ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏ ͏"",""IsMeetingInvite"":false,""HasConflict"":false,""ReceivedAt"":""2025-07-12T09:10:45Z"",""EventModel"":null,""CalendarEvent"":null,""NonMeetingInviteResponse"":{""Summary"":""the email sender expressed their interest in viewing jobs within the frankfurt rhine-main metropolitan area, prompting us to provide information on the available positions and relevant job search resources for them.\n\n-----------\ndear [recipient's name],\n\nthank you for your inquiry about job opportunities in the frankfurt rhine-main metropolitan area. our database currently has a variety of roles across various industries, including finance, technology, healthcare, and more. you can explore these positions through our online portal or directly contact employers to request information on available vacancies.\n\nto begin your job search journey, you may also consider utilizing additional resources such as the official frankfurt rhine-main metropolitan area jobs webpage, local networking events, and professional social media platforms like linkedin for further assistance in finding suitable positions.\n\nif there is anything specific that you need help with or any particular industries or job roles you are interested in, please let us know so we can provide more targeted information to assist your search.\n\nwe hope this helps and wish you luck in your career pursuits!\n\nkind regards,\n[your name]\n[your position]\n[company/organization]"",""ResponseSuggestedByLLM"":""dear [recipient's name],\n\nthank you for reaching out. we appreciate your interest in exploring job opportunities within the frankfurt rhine-main metropolitan area. below is a summary of the available jobs and resources that can assist you further:""},""Title"":null,""MessageId"":""<359464517.11659964.1752311445781@lva1-app52037.prod.linkedin.com>"",""Attendees"":null},{""From"":""Harris and Basit <harris.basit@gmail.com>"",""Snippet"":""Sync Abdul You have been invited by Harris and Basit to attend an event named Sync Abdul on Monday Jul 14, 2025 ⋅ 11am – 12pm (Central European Time - Berlin). When Monday Jul 14, 2025 ⋅ 11am – 12pm ("",""IsMeetingInvite"":true,""HasConflict"":true,""ReceivedAt"":""2025-07-12T09:08:24Z"",""EventModel"":{""StartDateTime"":""2025-07-14T11:00:00"",""EndDateTime"":""2025-07-14T12:00:00"",""Title"":""Sync Abdul You have been invited by Harris and Basit to attend an event named Sync Abdul on Monday Jul 14, 2025 ⋅ 11am – 12pm (Central European Time - Berlin). When Monday Jul 14, 2025 ⋅ 11am – 12pm ("",""ConflictingTitle"":""Working Day WSA"",""ConflictingStartDateTime"":""2025-07-14T08:30:00+02:00"",""ConflictingEndDateTime"":""2025-07-14T16:30:00+02:00"",""SuggestedStartDateTime"":""2025-07-15T13:00:00+02:00"",""SuggestedEndDateTime"":""2025-07-15T14:00:00+02:00"",""UpdateEvent"":{""EventId"":""41edsmi69h73f5a6feb0hgqqi9"",""EventObj"":{""anyoneCanAddSelf"":null,""attachments"":null,""attendees"":[{""additionalGuests"":null,""comment"":null,""displayName"":null,""email"":""harris.basit@gmail.com"",""id"":null,""optional"":null,""organizer"":true,""resource"":null,""responseStatus"":""accepted"",""self"":null,""ETag"":null},{""additionalGuests"":null,""comment"":null,""displayName"":null,""email"":""basit.a.raja@gmail.com"",""id"":null,""optional"":null,""organizer"":null,""resource"":null,""responseStatus"":""needsAction"",""self"":true,""ETag"":null}],""attendeesOmitted"":null,""birthdayProperties"":null,""colorId"":null,""conferenceData"":null,""created"":""2025-07-12T09:08:19.000Z"",""creator"":{""displayName"":null,""email"":""harris.basit@gmail.com"",""id"":null,""self"":null},""description"":null,""end"":{""date"":null,""dateTime"":""2025-07-15T14:00:00.000+02:00"",""timeZone"":""Europe/Berlin"",""ETag"":null},""endTimeUnspecified"":null,""etag"":""\""3504622607511454\"""",""eventType"":""default"",""extendedProperties"":null,""focusTimeProperties"":null,""gadget"":null,""guestsCanInviteOthers"":null,""guestsCanModify"":null,""guestsCanSeeOtherGuests"":null,""hangoutLink"":null,""htmlLink"":""https://www.google.com/calendar/event?eid=NDFlZHNtaTY5aDczZjVhNmZlYjBoZ3FxaTkgYmFzaXQuYS5yYWphQG0"",""iCalUID"":""41edsmi69h73f5a6feb0hgqqi9@google.com"",""id"":""41edsmi69h73f5a6feb0hgqqi9"",""kind"":""calendar#event"",""location"":null,""locked"":null,""organizer"":{""displayName"":null,""email"":""harris.basit@gmail.com"",""id"":null,""self"":null},""originalStartTime"":null,""outOfOfficeProperties"":null,""privateCopy"":null,""recurrence"":null,""recurringEventId"":null,""reminders"":{""overrides"":null,""useDefault"":true},""sequence"":0,""source"":null,""start"":{""date"":null,""dateTime"":""2025-07-15T13:00:00.000+02:00"",""timeZone"":""Europe/Berlin"",""ETag"":null},""status"":""confirmed"",""summary"":""Sync Abdul"",""transparency"":null,""updated"":""2025-07-12T09:08:23.755Z"",""visibility"":null,""workingLocationProperties"":null},""Attendees"":[""harris.basit@gmail.com"",""basit.a.raja@gmail.com""]},""SendEmailModel"":{""To"":""harris.basit@gmail.com"",""Subject"":""Reschedule: Sync Abdul"",""Message"":""Dear Organizer,\nI wanted to propose rescheduling the meeting currently set for: Sync Abdul on July 15 at 1:00 pm - July 15 at 2:00 pm.\nThanks!"",""MessageId"":null}},""CalendarEvent"":null,""NonMeetingInviteResponse"":null,""Title"":null,""MessageId"":""<calendar-7efb63dc-e0bf-4657-a475-af06c6862678@google.com>"",""Attendees"":null},{""From"":""Harris and Basit <harris.basit@gmail.com>"",""Snippet"":""Hey Abdul, Can we meet up tomorrow for a short meeting? Regards, Abdul"",""IsMeetingInvite"":true,""HasConflict"":false,""ReceivedAt"":""2025-07-12T09:07:44Z"",""EventModel"":null,""CalendarEvent"":{""Summary"":""Meeting Call set up by LLM Scheduler"",""Location"":""Berlin"",""Description"":""Meeting Call set up by LLM Scheduler"",""StartTime"":""2025-07-13T00:00:00"",""EndTime"":""2025-07-13T00:30:00"",""Attendees"":[""Harris and Basit <harris.basit@gmail.com>""]},""NonMeetingInviteResponse"":null,""Title"":null,""MessageId"":""<CAJByuP1CozWiZ+GGhA9TpnFoQQV4B88cmd3GZb175f49o-U-Og@mail.gmail.com>"",""Attendees"":null}]";
                // var data = JsonConvert.DeserializeObject<List<EmailModelSync>>(daaat);
                var emailsResponse = await _gmailService.CheckForNewEmails(emailSyncModel, accessToken, idToken);
                return Ok(emailsResponse);
            }
            catch (Exception ex)
            {
                return BadRequest($"Error fetching Mails from GetMailPolling: {ex.Message}");
            }
        }

        [TokenValidationFilter]
        [HttpGet("GetLastSyncDate")]
        public async Task<ActionResult> GetLastSyncDate(string? email)
        {
            try
            {
                var lastSyncDate = _gmailService.GetLastSyncDate(email!);
                return Ok(lastSyncDate);
            }
            catch (Exception ex)
            {
                return BadRequest($"Error fetching last sync data: {ex.Message}");
            }
        }
    }
}
